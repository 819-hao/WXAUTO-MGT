# wxauto_Mgt Web管理界面设计方案

## 1. 概述

本文档详细说明了wxauto_Mgt项目的Web管理界面设计方案。该Web界面将提供对wxauto_Mgt系统的远程管理能力，包括实例状态监控、消息监听服务管理、服务平台配置和消息转发规则管理等功能。

## 2. 技术选型

### 2.1 后端技术

1. **Web框架**: FastAPI
   - 高性能异步框架，与项目现有的asyncio架构完美兼容
   - 自动生成API文档，便于调试和集成
   - 内置数据验证和序列化功能

2. **数据库访问**: 
   - 复用现有的db_manager模块，保持数据一致性
   - 使用SQLite作为数据存储，与桌面应用共享同一数据库

3. **异步处理**: 
   - 使用asyncio进行异步操作
   - 与现有的异步架构无缝集成

4. **安全性**:
   - JWT令牌认证
   - HTTPS支持
   - API密钥验证

### 2.2 前端技术

1. **框架**: Vue.js 3 + Vite
   - 响应式框架，适合构建单页应用
   - 组件化开发，便于维护和扩展
   - 轻量级，加载速度快

2. **UI组件库**: Element Plus
   - 美观现代的UI组件
   - 丰富的表单控件和数据展示组件
   - 支持响应式设计

3. **状态管理**: Pinia
   - Vue.js 3官方推荐的状态管理库
   - 类型安全，支持TypeScript
   - 简洁的API设计

4. **图表库**: ECharts
   - 强大的图表可视化库
   - 支持多种图表类型
   - 可定制性强

5. **HTTP客户端**: Axios
   - 基于Promise的HTTP客户端
   - 支持拦截器和请求/响应转换
   - 错误处理机制完善

## 3. 系统架构

### 3.1 整体架构

```
+-------------------+      +-------------------+      +-------------------+
|                   |      |                   |      |                   |
|  Vue.js 前端      |<---->|  FastAPI 后端     |<---->|  wxauto_Mgt 核心  |
|  (浏览器)         |      |  (Web服务)        |      |  (现有系统)       |
|                   |      |                   |      |                   |
+-------------------+      +-------------------+      +-------------------+
                                    |
                                    v
                           +-------------------+
                           |                   |
                           |  SQLite 数据库    |
                           |                   |
                           +-------------------+
```

### 3.2 模块划分

1. **Web服务模块**:
   - API路由管理
   - 认证和授权
   - 请求处理和响应生成
   - WebSocket实时通信

2. **前端模块**:
   - 用户界面组件
   - 状态管理
   - API调用服务
   - 实时数据更新

3. **集成模块**:
   - 与现有wxauto_Mgt系统的集成接口
   - 数据同步机制
   - 事件通知系统

## 4. 功能设计

### 4.1 核心功能

1. **实例管理**:
   - 查看所有wxauto实例状态
   - 添加/编辑/删除实例
   - 启用/禁用实例
   - 查看实例详细信息和性能指标

2. **服务平台管理**:
   - 查看所有服务平台
   - 添加/编辑/删除服务平台
   - 测试服务平台连接
   - 配置服务平台参数

3. **消息转发规则管理**:
   - 查看所有转发规则
   - 添加/编辑/删除转发规则
   - 设置规则优先级
   - 配置@消息规则

4. **消息监听**:
   - 查看实时消息流
   - 查看消息处理状态
   - 手动处理/重试消息
   - 查看历史消息记录

5. **系统监控**:
   - 查看系统运行状态
   - 查看性能指标
   - 查看日志信息
   - 系统配置管理

### 4.2 Web服务配置

1. **服务控制**:
   - 启动/停止Web服务
   - 设置端口号(默认8443)
   - 配置HTTPS证书
   - 设置访问控制

2. **用户管理**:
   - 创建/编辑/删除用户
   - 设置用户权限
   - 修改密码
   - 会话管理

## 5. 界面设计

### 5.1 整体布局

采用现代化的管理界面布局:

1. **顶部导航栏**:
   - 系统标题和Logo
   - 用户信息和退出按钮
   - 系统通知

2. **左侧菜单**:
   - 实例管理
   - 服务平台管理
   - 消息转发规则
   - 消息监听
   - 系统设置

3. **主内容区**:
   - 数据展示和操作界面
   - 响应式设计，适应不同屏幕尺寸

4. **底部状态栏**:
   - 系统状态信息
   - 版本信息
   - 版权信息

### 5.2 主要页面设计

1. **仪表盘**:
   - 系统概览
   - 实例状态卡片
   - 消息处理统计图表
   - 最近活动日志

2. **实例管理页面**:
   - 实例列表(卡片式布局)
   - 实例详情面板
   - 添加/编辑实例表单
   - 实例状态指标图表

3. **服务平台管理页面**:
   - 服务平台列表
   - 平台详情和配置
   - 添加/编辑平台表单
   - 平台测试功能

4. **消息转发规则页面**:
   - 规则列表(表格式布局)
   - 规则详情和配置
   - 添加/编辑规则表单
   - 规则优先级调整

5. **消息监听页面**:
   - 实时消息流
   - 消息过滤和搜索
   - 消息详情查看
   - 消息处理操作

6. **系统设置页面**:
   - Web服务配置
   - 用户管理
   - 系统参数设置
   - 日志查看和下载

## 6. API设计

### 6.1 RESTful API

设计符合RESTful风格的API:

1. **实例管理API**:
   - `GET /api/instances` - 获取所有实例
   - `GET /api/instances/{instance_id}` - 获取特定实例
   - `POST /api/instances` - 创建新实例
   - `PUT /api/instances/{instance_id}` - 更新实例
   - `DELETE /api/instances/{instance_id}` - 删除实例
   - `PATCH /api/instances/{instance_id}/status` - 更新实例状态

2. **服务平台API**:
   - `GET /api/platforms` - 获取所有服务平台
   - `GET /api/platforms/{platform_id}` - 获取特定服务平台
   - `POST /api/platforms` - 创建新服务平台
   - `PUT /api/platforms/{platform_id}` - 更新服务平台
   - `DELETE /api/platforms/{platform_id}` - 删除服务平台
   - `POST /api/platforms/{platform_id}/test` - 测试服务平台连接

3. **转发规则API**:
   - `GET /api/rules` - 获取所有规则
   - `GET /api/rules/{rule_id}` - 获取特定规则
   - `POST /api/rules` - 创建新规则
   - `PUT /api/rules/{rule_id}` - 更新规则
   - `DELETE /api/rules/{rule_id}` - 删除规则
   - `PATCH /api/rules/{rule_id}/priority` - 更新规则优先级

4. **消息API**:
   - `GET /api/messages` - 获取消息列表
   - `GET /api/messages/{message_id}` - 获取特定消息
   - `PATCH /api/messages/{message_id}/status` - 更新消息状态
   - `POST /api/messages/{message_id}/retry` - 重试消息处理

5. **系统API**:
   - `GET /api/system/status` - 获取系统状态
   - `GET /api/system/logs` - 获取系统日志
   - `GET /api/system/metrics` - 获取性能指标
   - `PUT /api/system/config` - 更新系统配置

### 6.2 WebSocket API

用于实时数据更新:

1. **消息实时更新**:
   - `ws://server/ws/messages` - 消息实时流

2. **状态实时更新**:
   - `ws://server/ws/status` - 实例状态实时更新

3. **日志实时更新**:
   - `ws://server/ws/logs` - 系统日志实时流

## 7. 实现计划

### 7.1 开发阶段

1. **阶段一: 基础架构搭建**
   - 设置FastAPI服务器
   - 集成现有数据库
   - 实现基本认证机制
   - 搭建Vue.js前端框架

2. **阶段二: 核心功能实现**
   - 实例管理功能
   - 服务平台管理功能
   - 消息转发规则管理功能
   - 基本UI组件开发

3. **阶段三: 高级功能实现**
   - 实时消息监控
   - WebSocket集成
   - 图表和数据可视化
   - 系统配置和用户管理

4. **阶段四: 优化和测试**
   - 性能优化
   - 用户体验改进
   - 兼容性测试
   - 安全性测试

### 7.2 集成计划

1. **与现有系统集成**:
   - 在wxauto_Mgt主程序中添加Web服务启动/停止功能
   - 确保数据库访问的线程安全
   - 实现事件通知机制

2. **部署策略**:
   - 将前端资源打包为静态文件
   - 通过FastAPI提供静态文件服务
   - 配置HTTPS和安全策略
