# WxAuto管理程序 AI开发提示词

本文档提供了针对每个模块的开发提示词，旨在辅助AI模型理解和实现WxAuto管理程序的各个功能模块。

## 项目概述提示词

```
你将开发一个名为WxAuto管理程序的Python应用程序，作为WxAuto HTTP API的客户端，管理多个WxAuto实例并提供微信消息监听服务。

项目特点：
1. 使用Python 3.11 + PySide6开发
2. 使用SQLite进行数据持久化
3. 支持同时管理多个不同服务器上的WxAuto实例
4. 实现自动监听微信消息并转发到第三方服务
5. 集成ASTRBot作为消息处理平台
6. 提供简洁美观的用户界面展示各实例状态和消息流
7. 最终将打包为Windows可执行文件

开发时请遵循模块化、高内聚低耦合的设计原则，代码应简洁清晰，包含适当注释。
```

## 核心服务层模块提示词

### API客户端模块

```
你需要开发WxAuto管理程序的API客户端模块(app/core/api_client.py)，该模块负责与WxAuto HTTP API进行通信。

关键需求：
1. 使用aiohttp实现异步HTTP请求
2. 封装WxAuto HTTP API的所有接口调用
3. 处理API认证、请求和响应
4. 实现请求重试机制和错误处理
5. 支持管理多个WxAuto实例（不同IP和端口）

主要功能：
- 初始化微信实例
- 获取微信状态
- 发送各类消息（文本、文件等）
- 获取未读消息
- 管理监听对象
- 获取监听消息

API文档已提供，详见docs/api_documentation.md，应直接调用这些API而非重新实现。

实现时需要考虑：
1. 连接错误和超时处理
2. API密钥的安全存储和使用
3. 各实例的状态跟踪和管理
4. 合理的日志记录便于问题排查

请提供WxAutoApiClient和WxAutoInstanceManager类的完整实现。
```

### 消息监听管理器

```
你需要开发WxAuto管理程序的消息监听管理器(app/core/message_listener.py)，该模块负责管理微信消息的监听、接收和分发。

关键需求：
1. 定时获取主窗口未读消息（默认每5秒一次）
2. 自动将新的未读消息对象添加到监听列表
3. 定期获取监听对象的最新消息（每5秒一次）
4. 支持最多30个监听对象
5. 将获取的消息暂存在消息队列中，用于投递到第三方服务
6. 自动移除30分钟内无新消息的监听对象

主要功能：
- 启动和停止监听服务
- 检查主窗口未读消息
- 添加和移除监听对象
- 检查监听对象的新消息
- 管理消息队列
- 超时处理机制

实现时需要考虑：
1. 使用asyncio实现并发任务
2. 合理管理监听对象的生命周期
3. 处理API调用异常
4. 高效的消息队列管理
5. 状态持久化（恢复监听）

请提供MessageListener类的完整实现，确保它能够与API客户端和消息存储模块协同工作。
```

### 状态监控服务

```
你需要开发WxAuto管理程序的状态监控服务(app/core/status_monitor.py)，该模块负责监控WxAuto实例的状态和性能指标。

关键需求：
1. 定期检查微信连接状态（默认每60秒一次）
2. 收集和存储消息处理统计数据
3. 监控各实例的性能指标
4. 提供状态报告和警报机制

主要功能：
- 启动和停止监控服务
- 检查微信状态
- 记录消息统计数据（处理数量、成功数、失败数）
- 生成状态报告
- 获取性能指标

监控指标包括：
- 微信的运行状态（在线/离线）
- 已处理的消息数量
- 消息队列的数量
- 消息队列的空闲时间
- 响应时间统计

实现时需要考虑：
1. 使用asyncio实现定时任务
2. 合理组织和存储监控数据
3. 提供异常情况的警报机制
4. 确保监控功能不影响主服务性能
5. 数据可视化的便利支持

请提供StatusMonitor类的完整实现，确保它能够与API客户端和数据存储模块协同工作。
```

### 配置管理器

```
你需要开发WxAuto管理程序的配置管理器(app/core/config_manager.py)，该模块负责管理程序的配置信息。

关键需求：
1. 使用SQLite存储配置数据
2. 提供默认配置项
3. 支持配置的验证和动态更新
4. 敏感信息（如API密钥）需加密存储

主要功能：
- 加载和保存配置
- 获取和设置配置项
- 验证配置有效性
- 配置变更通知
- 配置导入/导出

核心配置项包括：
- WxAuto实例信息（名称、地址、端口、API密钥）
- 消息监听设置（轮询间隔、最大监听数、超时时间）
- 第三方服务集成设置
- 日志设置（级别、路径）
- 界面设置（主题、布局）
- 应用锁定密码（如需要）

实现时需要考虑：
1. 配置数据的版本管理
2. 敏感信息的加密和解密
3. 多实例配置独立管理
4. 配置验证和错误报告
5. 用户友好的配置接口

请提供ConfigManager类的完整实现，它应能与SQLite数据库交互并提供全面的配置管理功能。
```

## 接口层模块提示词

### ASTRBot平台适配器

```
你需要开发WxAuto管理程序的ASTRBot平台适配器(app/api/integrations/astrbot_service.py)，该模块负责将WxAuto的消息集成到ASTRBot平台。

关键需求：
1. 按照ASTRBot平台适配器开发规范实现
2. 将WxAuto消息转换为ASTRBot消息格式
3. 实现消息的双向传递
4. 支持文本、图片等多种消息类型

主要功能：
- 初始化ASTRBot服务连接
- 处理来自WxAuto的消息并转发到ASTRBot
- 接收ASTRBot的响应并转发回WxAuto
- 管理会话和上下文
- 处理错误和异常情况

开发要点：
1. 参考文档docs/astrbot开发规范.md中的"平台适配器"部分
2. 实现所需的接口和事件处理逻辑
3. 确保消息格式的正确转换
4. 实现适当的错误处理和重试机制
5. 提供配置选项以便用户自定义集成行为

请提供ASTRBotService类的完整实现，确保它能够正确地与ASTRBot平台进行通信，并与消息监听管理器协同工作。
```

### 第三方集成接口

```
你需要开发WxAuto管理程序的第三方集成接口基础框架(app/api/integrations/base.py, llm_service.py)，该模块负责提供统一的接口用于集成第三方服务。

关键需求：
1. 设计通用的集成接口抽象类
2. 提供LLM服务的集成实现
3. 支持未来扩展更多服务
4. 确保接口的一致性和可测试性

主要功能：
- 定义通用的消息处理接口
- 实现消息格式转换
- 处理认证和配置
- 提供错误处理和日志记录
- 支持异步消息处理

设计要点：
1. 使用抽象基类(ABC)定义接口
2. 提供合理的默认实现
3. 设计可扩展的消息格式
4. 考虑不同服务的特殊需求
5. 提供测试和模拟功能

请提供BaseIntegrationService抽象类和LLMService类的完整实现，确保它们能够为各种第三方服务集成提供统一的接口。
```

### 事件分发系统

```
你需要开发WxAuto管理程序的事件分发系统(app/api/event_system.py)，该模块负责处理系统内部的事件分发和通知。

关键需求：
1. 实现事件发布/订阅机制
2. 支持异步事件处理
3. 提供事件优先级和过滤
4. 确保事件处理的可靠性

主要功能：
- 事件注册和订阅
- 事件发布和分发
- 事件处理队列管理
- 错误处理和恢复机制
- 事件记录和监控

设计要点：
1. 使用asyncio实现异步事件处理
2. 提供类型安全的事件接口
3. 实现事件处理超时和重试机制
4. 支持事件处理的优先级
5. 提供事件处理的监控和统计

支持的事件类型：
- 消息接收事件
- 消息发送事件
- 状态变更事件
- 配置变更事件
- 错误和警告事件

请提供EventBus类的完整实现，确保它能够高效地处理系统内部的事件分发，并与其他模块良好协作。
```

## UI界面层模块提示词

### 主控制面板

```
你需要开发WxAuto管理程序的主控制面板(app/ui/main_window.py)，该模块负责提供程序的主窗口界面，整合各个功能面板。

关键需求：
1. 使用PySide6实现简洁美观的用户界面
2. 提供良好的用户体验和导航
3. 支持不同功能面板的切换
4. 展示系统整体状态

主要功能：
- 创建主窗口和基本布局
- 集成各个功能面板（状态监控、消息管理、配置设置）
- 提供全局菜单和工具栏
- 状态栏显示系统状态
- 窗口大小和位置记忆

界面设计要点：
1. 使用标签页或侧边栏导航不同功能面板
2. 提供直观的实例选择和切换机制
3. 显示重要状态信息和提醒
4. 支持基本的窗口操作（最小化、最大化、关闭）
5. 简洁但功能完备的布局

请提供MainWindow类的完整实现，确保它能够正确地集成各个功能面板，并提供良好的用户体验。
```

### 状态监控面板

```
你需要开发WxAuto管理程序的状态监控面板(app/ui/status_panel.py)，该模块负责显示WxAuto实例的状态和性能指标。

关键需求：
1. 直观展示各实例的运行状态
2. 显示关键性能指标和统计数据
3. 提供状态刷新和手动检查功能
4. 支持问题预警和通知

主要功能：
- 实例状态概览（在线/离线、启动时间）
- 消息处理统计（已处理数量、队列大小、成功率）
- 性能指标可视化（图表或进度条）
- 状态刷新控制
- 实例操作按钮（连接、断开、重启）

界面设计要点：
1. 使用卡片式布局展示多个实例
2. 使用颜色编码直观表示状态（绿色正常、红色错误等）
3. 提供详细信息的展开/折叠功能
4. 重要指标应突出显示
5. 支持按需刷新或自动刷新

请提供StatusPanel类的完整实现，确保它能够与状态监控服务协同工作，实时显示准确的状态信息。
```

### 消息管理面板

```
你需要开发WxAuto管理程序的消息管理面板(app/ui/message_panel.py)，该模块负责显示和管理微信消息。

关键需求：
1. 展示当前监听的对象列表
2. 显示消息队列和消息内容
3. 提供消息操作功能
4. 支持监听对象的管理

主要功能：
- 监听对象列表（带状态指示）
- 消息历史记录查看
- 消息队列状态展示
- 手动添加/移除监听对象
- 消息筛选和搜索

界面设计要点：
1. 使用分割视图同时显示监听对象和消息内容
2. 提供清晰的消息时间线
3. 使用不同样式区分消息类型（文本、图片等）
4. 支持消息内容的复制和保存
5. 提供消息统计信息

请提供MessagePanel类的完整实现，确保它能够与消息监听管理器协同工作，提供良好的消息管理体验。
```

### 配置设置面板

```
你需要开发WxAuto管理程序的配置设置面板(app/ui/config_panel.py)，该模块负责管理程序的配置设置。

关键需求：
1. 提供用户友好的配置界面
2. 支持实例配置的管理
3. 提供系统设置和偏好选项
4. 实现配置的验证和保存

主要功能：
- WxAuto实例管理（添加、编辑、删除）
- 消息监听设置（轮询间隔、超时时间等）
- 第三方服务集成配置
- 日志设置（级别、路径）
- 界面设置（主题、语言等）
- 应用锁定设置

界面设计要点：
1. 使用分类标签或树形结构组织不同设置
2. 提供适当的输入控件（文本框、下拉列表、复选框等）
3. 实时验证输入有效性
4. 提供重置为默认值的选项
5. 确保设置变更得到及时保存

请提供ConfigPanel类的完整实现，确保它能够与配置管理器协同工作，提供良好的配置管理体验。
```

## 数据持久层模块提示词

### 消息队列存储

```
你需要开发WxAuto管理程序的消息队列存储模块(app/data/message_store.py)，该模块负责存储和管理消息数据。

关键需求：
1. 使用SQLite实现持久化消息队列
2. 支持消息的存储、查询和状态管理
3. 确保消息处理的可靠性和效率
4. 提供消息队列的统计和管理功能

主要功能：
- 保存接收到的消息
- 查询待处理的消息
- 更新消息处理状态
- 清理已完成的消息
- 提供消息统计数据

数据模型设计：
- message_id: 消息唯一标识
- instance_id: 所属实例ID
- sender: 发送者信息
- receiver: 接收者信息
- content: 消息内容（支持不同类型）
- timestamp: 消息时间戳
- status: 处理状态（待处理、已处理、失败）
- retry_count: 重试次数
- last_update: 最后更新时间

实现要点：
1. 使用异步数据库操作
2. 实现消息批量处理功能
3. 提供消息超时和重试机制
4. 确保线程安全和并发访问
5. 实现定期数据清理

请提供MessageStore类的完整实现，确保它能够高效可靠地管理消息队列，并支持与消息监听管理器的协同工作。
```

### 配置存储

```
你需要开发WxAuto管理程序的配置存储模块(app/data/config_store.py)，该模块负责管理配置数据的持久化。

关键需求：
1. 使用SQLite存储配置数据
2. 支持配置的版本管理
3. 提供安全的敏感信息存储
4. 确保配置操作的原子性和可靠性

主要功能：
- 读取和写入配置数据
- 管理配置模式和版本
- 加密和解密敏感信息
- 配置备份和恢复
- 默认配置初始化

数据模型设计：
- 配置表：存储键值对配置
- 实例表：存储WxAuto实例信息
- 版本表：存储配置版本信息
- 加密配置表：存储敏感配置

实现要点：
1. 使用异步数据库操作
2. 实现配置数据的加密和解密
3. 提供配置导入/导出功能
4. 确保配置存储的原子性
5. 实现配置变更通知机制

请提供ConfigStore类的完整实现，确保它能够安全可靠地管理配置数据，并支持与配置管理器的协同工作。
```

### 状态日志

```
你需要开发WxAuto管理程序的状态日志模块(app/data/status_log.py)，该模块负责记录系统状态和性能日志。

关键需求：
1. 使用SQLite存储状态日志
2. 支持不同类型和级别的日志记录
3. 提供查询和分析功能
4. 实现日志轮换和清理

主要功能：
- 记录实例状态变更
- 记录消息处理统计
- 记录系统事件和错误
- 查询历史状态和性能数据
- 生成状态报告和分析

数据模型设计：
- 状态日志表：记录状态变更
- 性能统计表：记录性能指标
- 错误日志表：记录错误和异常
- 系统事件表：记录系统事件

实现要点：
1. 使用异步数据库操作
2. 实现高效的日志写入（批量处理）
3. 提供灵活的查询和过滤功能
4. 确保日志记录不影响系统性能
5. 实现自动日志清理和归档

请提供StatusLogger类的完整实现，确保它能够高效可靠地记录系统状态和性能数据，并支持与状态监控服务的协同工作。
```

## 主程序开发提示词

```
你需要开发WxAuto管理程序的主程序入口(main.py)和构建脚本(build.py)，负责程序的初始化、启动和打包。

main.py 关键需求：
1. 初始化应用程序环境
2. 加载核心组件和服务
3. 启动UI界面
4. 提供优雅的退出机制

build.py 关键需求：
1. 配置PyInstaller打包参数
2. 处理依赖和资源文件
3. 生成Windows可执行文件
4. 提供版本信息和构建配置

主程序实现要点：
1. 使用异步设计启动核心服务
2. 实现优雅的错误处理和恢复
3. 确保组件按正确顺序初始化和关闭
4. 提供命令行参数支持
5. 实现日志系统初始化

打包脚本实现要点：
1. 正确配置PyInstaller选项
2. 处理特殊依赖和资源文件
3. 实现版本信息注入
4. 提供开发和生产环境的不同配置
5. 确保生成的可执行文件包含所有必要组件

请提供main.py和build.py的完整实现，确保它们能够正确地初始化、启动和打包WxAuto管理程序。
``` 